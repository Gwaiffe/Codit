<!DOCTYPE html>
<html>
<head>
    <title>Forex Trading Bot Dashboard</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #0f172a; color: white; }
        .container { max-width: 1400px; margin: 0 auto; }
        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: #1e293b; padding: 20px; border-radius: 10px; text-align: center; }
        .stat-value { font-size: 2em; font-weight: bold; }
        .stat-label { color: #94a3b8; margin-top: 5px; }
        .positive { color: #10b981; }
        .negative { color: #ef4444; }
        .chart-container { background: #1e293b; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #334155; }
        th { background: #1e293b; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ“Š Forex Trading Bot Dashboard</h1>
        
        <div class="stats-grid" id="stats-grid">
            <!-- Stats will be populated by JavaScript -->
        </div>
        
        <div class="chart-container">
            <h3>Equity Curve</h3>
            <div id="equity-chart" style="height: 400px;"></div>
        </div>
        
        <div class="chart-container">
            <h3>Daily Performance</h3>
            <div id="daily-chart" style="height: 300px;"></div>
        </div>
        
        <div class="chart-container">
            <h3>Recent Trades</h3>
            <table id="trades-table">
                <thead>
                    <tr>
                        <th>Time</th>
                        <th>Type</th>
                        <th>Symbol</th>
                        <th>Lots</th>
                        <th>Entry</th>
                        <th>Exit</th>
                        <th>Profit</th>
                    </tr>
                </thead>
                <tbody id="trades-body">
                    <!-- Trades will be populated by JavaScript -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        async function loadDashboard() {
            // Load performance data
            const perfResponse = await fetch('/api/performance');
            const perfData = await perfResponse.json();
            
            // Update stats grid
            const stats = perfData.summary || {};
            document.getElementById('stats-grid').innerHTML = `
                <div class="stat-card">
                    <div class="stat-value">${stats.total_trades || 0}</div>
                    <div class="stat-label">Total Trades</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value ${stats.win_rate >= 50 ? 'positive' : 'negative'}">
                        ${(stats.win_rate || 0).toFixed(1)}%
                    </div>
                    <div class="stat-label">Win Rate</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value ${stats.total_profit >= 0 ? 'positive' : 'negative'}">
                        $${(stats.total_profit || 0).toFixed(2)}
                    </div>
                    <div class="stat-label">Total Profit</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">
                        ${stats.winning_trades || 0}/${stats.losing_trades || 0}
                    </div>
                    <div class="stat-label">W/L Ratio</div>
                </div>
            `;
            
            // Load trades
            const tradesResponse = await fetch('/api/trades');
            const trades = await tradesResponse.json();
            
            // Update trades table
            const tradesBody = document.getElementById('trades-body');
            tradesBody.innerHTML = trades.map(trade => `
                <tr>
                    <td>${new Date(trade.timestamp).toLocaleString()}</td>
                    <td>
                        <span style="color: ${trade.type === 'BUY' ? '#10b981' : '#ef4444'}">
                            ${trade.type}
                        </span>
                    </td>
                    <td>${trade.symbol}</td>
                    <td>${trade.lots}</td>
                    <td>${trade.entry_price?.toFixed(5) || ''}</td>
                    <td>${trade.exit_price?.toFixed(5) || ''}</td>
                    <td class="${trade.profit >= 0 ? 'positive' : 'negative'}">
                        $${trade.profit?.toFixed(2) || '0.00'}
                    </td>
                </tr>
            `).join('');
            
            // Create charts
            if (perfData.daily) {
                const dates = perfData.daily.map(d => d.date);
                const profits = perfData.daily.map(d => d.daily_profit);
                
                Plotly.newPlot('daily-chart', [{
                    x: dates,
                    y: profits,
                    type: 'bar',
                    marker: {
                        color: profits.map(p => p >= 0 ? '#10b981' : '#ef4444')
                    }
                }], {
                    title: 'Daily Profit/Loss',
                    paper_bgcolor: '#1e293b',
                    plot_bgcolor: '#1e293b',
                    font: { color: 'white' }
                });
            }
        }
        
        // Refresh every 30 seconds
        loadDashboard();
        setInterval(loadDashboard, 30000);
    </script>
</body>
</html>